# 1 章：Linux とは

## 基本ソフトウェアと応用ソフトウェア

- 基本ソフト・・・OS
- 応用ソフト・・・各アプリケーション

## UNIX

- Linux の基本設計は UNIX からきている
- Linux は GPL(GNU General Public License: GNU 一般公衆利用許諾)で公開されたことにより広く一般に浸透した

## Linux の特徴

- カーネル・・・OS の中核。ハードウェアの違いを吸収。
- ユーザランド・・・OS が動作するのに必要な、カーネル以外の部分のこと。ファイルシステム・シェルなど。
- シェル・・・対話型のコマンド入力環境。通常のコマンド受付の他、シェルスクリプトという、コマンドの自動化も使える。サーバ起動時に実行、毎日 0 時に実行、など。

## ディストリビューション

- Red Hat,Debian,Ubuntu など
- パッケージ・・・応用ソフトウェアを簡単に導入できるようにするためのもの
- パッケージマネージャ・・・パッケージの依存関係をまとめてマネジメントしたり、更新・削除なども含めて対応してくれるやつ。
  インターネットに接続されている必要がある模様。

# 2 章：Linux のインストール

- CentOS を使用・・・商用ディストリビューションである Red Hat Enterprise Linux の互換ディストリビューション  
  ⇨ 別 PC 用意 ×
  ⇨WLS で CentOS が標準サポートされてない模様？
  ⇨VirtualBox にて仮想マシンとして導入

# 3 章：基本的なコマンド

## ファイル操作

- フォルダ・ファイルの概念・呼び方は Windows と同じ模様
- 入力ソース

  - 日本語(かな漢字)で OK
  - その中に入力入力モードが複数あり、全／半キーで切替可能

- 「\*」でワイルドカード検索可能 ls コマンドなど
- 文字数で絞る場合は対象部分を「???」などとすることも可能
- -l オプションで長形式で情報取得
- オプションコマンドは複数使う場合まとめて記述できる模様
  - -lar ⇨ 隠しファイル含め長形式で逆順ソート表示
- cp コマンド ・・・コピー
  - 対象の状況によって新規・上書など色んな動きをする
  - 基本はファイル単位が多少だが -r オプションでディレクトリのコピーも可能
- mv コマンド・・・ファイル・ディレクトリの移動／名前の変更
- rm コマンド・・・ファイル・ディレクトリの削除
  - -r rm・mv コマンド共通のオプションで、『再帰的』を意味している。階層構造の中の中まで対象にする。

## ディレクトリ操作

- pwd ・・・Print Working Directory
- mkdir・・・ディレクトリ作成
  - -p オプションで複数階層に渡る新規ディレクトリを一発で作成することが可能
- rmdir ・・・ディレクトリ削除。中にファイルがある状態では実行できない
  - rm コマンドの-r オプション付き　という形で中身の入ったディレクトリ全削除も行える。
- カレントディレクトリは「.」で表す
- 親ディレクトリは「..」で表す
- ホームディレクトリは「~」チルダ　で表す
- ルートディレクトリは「/」で表す。最上位階層。
  - ホームディレクトリはあくまでホームであって、最上位階層ではない。ので、ホームディレクトリで cd .. すれば、それより上の階層に行ける。

## ファイルの内容を表示

- cat・・・ファイルの中身表示。-n オプションで行番号付。
- more/less・・・ページャ。cat の替わりに使える。色々操作でき、q キーで終了。

## ファイルの検索

- find・・・ファイル検索

## コマンドのパス

- コマンドもプログラムの一つであり、/bin や/sbin といったプログラム用のディレクトリ配下に配置されている。
- which コマンドで対象コマンドがどこに配置されているのかが確認できる。

## オンラインマニュアル

- man [対象コマンド]でオンラインマニュアルをページャで開ける。
- マニュアルには何に関することなのか、1~9 までのセクションが設けられている。ls なら 1.ユーザコマンド。

# 正規表現とパイプ

## 標準入出力

Linux のプログラムには 1 つの入口と 2 つの出口がある。
標準入力・標準出力・標準エラー出力。

## リダイレクト

- コマンド > 指定の出力先　と指定すると、標準出力を対象ファイルに出力できる。ターミナルへの標準出力をリダイレクトするということ。

- cat コマンドとリダイレクトを組み合わせれば入力待ち状態となり、自由な内容で新規ファイルを生成することができる。
  - 入力が終わったら ctrl+D で終了。(EOF 信号)
- 標準エラー出力だけを指定してリダイレクトできたりもする。標準出力は 1、標準エラー出力は 2 で指定する。

## パイプ

コマンドとコマンドを「|（パイプ）」でつなげることでパイプの前のコマンドを後ろのコマンドの標準入力とすることができる。

## grep コマンド

- 絞り込み。正規表現により様々に検索可能。

# 基本的なコマンド 2

## touch

- 対象ファイルのタイムスタンプを更新。
- -t オプションで日時の指定も可能。
- ファイルが存在しない場合は新規作成となる。

## ファイルの一部取得

- head・・・対象ファイルの先頭 10 行を表示。-n オプションで行数指定。
  ファイルの指定無しの場合は標準入力を対象とする(パイプで繋いで使用)。

- tail・・・対象ファイルの末尾　以下同文。-f オプションを付けることで、変更をリアルタイムに確認可能。ログを対象ファイルに排出している場合など。Ctrl+C で終了。

## ソート

- sort でテキストファイルの行をソート可能
  - 半角スペースで列を分割
  - -k コマンド+列の指定で、その列を対象としてソート可能。
  - 辞書式・数値式に分かれる。-n オプションを付けると数値式ソートとなる。

## 行の重複の消去

- uniq コマンドで対象ファイルを表示。連続して同じ内容の行はスルーされる。

## 文字列の置き換え

- tr コマンド(Translate)で対象 1 を対象 2 に置換。標準入力を対象とする。
- 文字列、というよりは一文字一文字を対象としている。
- あくまで標準出力されるだけ。元のファイルは変更されない。
  - リダイレクトで新規ファイルに排出、という使い方もできる。

## ファイルの比較(diff)

- ファイルとファイルの比較。
- -u・-c オプションで詳細表示可能。

# vi エディタ

※一旦とばす

# 管理者の仕事

## グループとユーザ

- Linux を利用するにはユーザアカウントが必要。
- グループを使えば複数のアカウントを束ねることが可能
- システム管理者は必要に応じてユーザを定義できる。
  - ユーザの定義は/etc/passwd ファイルに記述。直接編集ではなく、専用のコマンドで編集することが推奨されている。
  - useradd・・・ユーザの新規作成
  - -g でグループ指定、-u でユーザ ID 指定可能。
- ユーザアカウントを変更するには usermod コマンドを使う。(modify かな？)
  - -c オプションでコメントの変更
- ユーザの削除には userdel コマンド
- ユーザは必ず 1 つ以上のグループに所属する。主要な所属グループをプライマリグループと呼ぶ。
- /etc/group ファイルに内容記述。ユーザと同じく、グループも定義ファイルを直接触るのではなく専用コマンドで編集うすことが推奨されている。
- groupadd・・・グループの新規作成。
- groupmod・・・編集
- groupdel・・・削除。ユーザが所属していないグループのみ削除可能。

## パスワードとパスワードファイル

ユーザを利用するにはパスワードが必要で、パスワード情報は/etc/shadow ファイルに暗号化の上で保存されている。

### パスワードファイル

- パスワードファイルに記述された 1 行あたりのユーザ情報は下記のようになる。

  > account:password:UID:GID:GECOS:directory:shell

  ※ GECOS = General Electric Comprehensive Operating System 　ユーザの名前またはコメントのフィールド。

  - パスワード部は現在では shadow ファイルに記述される為、x とだけ記述されている。

### グループファイル

- グループファイルの 1 行あたりの内容は次の通り。
  > group_name:password:GID:user_list

### パスワード

- 作成したユーザはパスワードを登録するとログイン可能に。
- パスワードの登録にはパスワードが必要のため、最初は root ユーザでやる必要がある。
- コマンドとしての passwd コマンドで編集していく。

### シャドウファイル

- シャドウファイルの 1 行あたりの内容は以下の通り。
  > account:password:last_changed:may_be_changed:must_be_changed:warned:expires:disabled:reserved

## 用意されているユーザとグループ

- root ユーザ・・・アクセス権に関係なくすべてのユーザのディレクトリへのアクセス、コンテンツの読み書きが行える。このため厳格に管理する必要がある。
- su コマンド・・・すでにログイン中のユーザが一時的に他のユーザになるためのコマンド。

  - ユーザ名を指定しない場合は root ユーザでシェルを起動する。
  - 複数人で Linux システムを管理するような場合、直接 root ユーザでログインすると行動履歴の管理が難しい。そのため、一旦一般ユーザでログイン後に su コマンドで root に一時ログインし、行動履歴を残していくことが望ましい。

- sudo コマンド・・・su コマンドで root に切り替えることなく、root 権限が必要な設定やプログラムを実行することができる。
  - このとき、root にログインするためのパスワードも必要ない。
  - が、sudo コマンドを使えるユーザとして『wheel グループ』に所属する必要がある。

# ユーザ権限とアクセス権

## ファイルの所有者と所有グループ

ファイル・ディレクトリには所有者という概念がある模様。

- 所有者は chown、所有グループは chgrp コマンドで変更可能。
- ユーザ・グループを変更するには、root ユーザである必要がある。
- ディレクトリを対象として-R オプションで、そのディレクトリ以下のファイル・ディレクトリにも再帰的に変更をかける。
- ファイル・ディレクトリの属性としての『所有者と所有グループ』は、『その所有者』に『紐づくグループ』になってなくてもよい・・・模様？

## ファイルとアクセス権

ファイルは 3 つのレベルで権限を設定できる。

1. 所有ユーザ
1. 所有グループから所有ユーザを除いたユーザ
1. その他のユーザ

- ls -l 　で見れるファイル情報の 1 列目の羅列がその内容(ファイルモード)
  - 左から所有ユーザ・所有グループ・その他ユーザ　それぞれに対する権限が端的に表されている。
  - それぞれ rwx、読み・下記・実行　の権限が付与されているか、いないか、一目でわかる。
- chmod コマンドでモード変更可能。
  - u+rw・・・所有ユーザに読み・書き権限を付与。
  - 8 進数でより手早くモード指定可能。r=4、w ＝ 2、x ＝ 1 のとして、各レベルごとに 0 ～ 7 で指定。なので全部で 000 ～ 777 まで指定可能(のハズ？)
- モードの指定時に setuid ビット、setgid ビット、sticky ビットというのを付与できる。setuid ビットあるいは setgid ビットが付いたプログラムを実行すると、ファイル所有者あるいは所有グループの権限で実行される。  
  sticky ビットが付いたディレクトリ内のファイルは所有者以外が削除できなくなる。
- umask コマンドで、ファイルを新規作成した際のモードのデフォルト値を設定できる。所有ユーザ～その他ユーザまで全員が読み書きできる 666 設定から不要なものを引き算する形で指定。
  - umask コマンドによるモードの制限は、そのシェル内でしか有効でない(端末を閉じたら初期設定に戻ってた)。根源的なデフォルトモード設定はまた別にできる模様。

# シェルスクリプト

## シェルとシェルスクリプト

- シェルのコマンド処理をまとめたものをシェルスクリプトとしてまとめられる。拡張子は『.sh』。

## プログラミング

プログラミングには、どの種類のプログラムでも重要な構成要素がある。主に以下 4 つ。

- 順次実行
- 条件分岐
- 繰り返し
- サブルーチン

## シェルスクリプト

- シェルスクリプトファイルの 1 行目には、利用するシェルの種類とそのコマンド位置を記述する。1 行目に利用するシェルを指定(シェルには複数種類がある)、2 行目以降に実行するコマンドを 1 行ずつ入力していく。
- シェルスクリプトの実行には、パーミッションを編集してファイルの実行権限をつけてやる必要がある。
- ファイル名を入力して実行。シェルスクリプトファイルはパスが通ってない(?)ので、たとえカレントディレクトリにあるファイルでもパス指定が必要。
- 『#』でその行をコメントアウト可能
- echo・・・引数に指定した文字列を標準出力に出力。
- 変数・・・ruby とかと同様=で代入。呼び出す際はアタマに$を付ける。
- 配列・・・シェルでは 1 次元配列が利用可能。呼び出す際はアタマに$、配列名～要素番号までを{}で囲む。
- シェルにはシェル変数と環境変数の 2 種類の変数がある。
  - 環境変数は変数名の前に export をつけて定義。
  - 環境変数はシェルをまたいでも(?)有効。
- read コマンド・・・標準入力から変数にデータを読み込む。既にデータが入っている変数の場合は上書きされる。(変数の再定義とどう違うかはイマイチ不明)
- set コマンド・・・シェル変数の一覧が表示される。(デフォルトのものもズラッと表示される・・・)
- unset コマンドでシェル変数の削除
- 環境変数の一覧は env コマンド。削除はシェル変数と同じく、unset コマンド。
- 環境変数といっても、ターミナルを閉じたりログアウトした段階で消える模様。Qiita 記事から関連記事引用。

  > export コマンドで環境変数を設定してもサーバーからログアウトした時点で消えてしまう。
  > bash_profile や bashrc に export コマンドを記述しておくことで、起動する度に export が実行されるので、環境変数が無くなる心配がない。

- 引用符には""・''・``の 3 つあり、それぞれ挙動が異なる。
  - ''・・・中の変数も含め展開せずそのまま表示
  - ""・・・中に変数がある場合は展開して表示
  - ``・・・中のものをコマンドとして認識し、実行する
- 引用符は入れ子が可能。
- 引数・・・実行時にオプションとして引数を渡すことができる。引数は$1、$2…と$のあとに引数の番号を指定することで参照可能。
  - 例外として、$0は実行コマンド名、$#は引数の数が格納される。
- shift コマンド・・・引数の順序をずらせる(いつ使うか不明)
- エスケープシーケンス・・・『\』をエスケープ文字と呼ぶ。直後の 1 文字の扱いを変更する。引用符を無効化したりとか。改行したりとか。
  - \で、実行結果に影響をあたえずにコードの改行が可能。
- source コマンドは、bash などのシェルの内部コマンドで、指定されたファイルを読み込んでシェル環境を設定します。ファイル内容はシェルコマンドと解釈して実行します。(理解浅い)

## 条件分岐

他の言語同様 if 文がある。記法は結構違う。

## 繰り返し

for 文や while/until 文など色々。

## サブルーチン

- 一連の処理をまとめて再利用できるようにしたもの。いわゆる関数！シェルスクリプトでも関数と呼ぶ。
- /etc/init.d/functions は、/etc/の中に入っているさまざまなシェルスクリプトが、共通して利用できる便利な関数が入っています。
- コマンド１ && コマンド２
  - コマンド１が正常終了した場合、コマンド２を実行
- コマンド１ || コマンド２
  - コマンド１が異常終了した場合、コマンド２を実行中に入っているさまざまなシェルスクリプトが、共通して利用できる便利な関数が入っています。

## デバッグ

- シェルスクリプトにもデバッグモードがある。sh コマンドに-x オプションを付けて引数にシェルスクリプトを指定すると、コマンドや変数の中身を表示しながら実行される。

# ネットワークの設定と管理

Linux がネットワークにつながれたとき、必要とされる基礎知識と確認コマンドと設定を見ていきます。

## TCP/IP

- ping コマンド・・・ターゲットにデータを送り、返答があるまでの時間を表示
- UDP(User Datagram Protocol) ・・・エラー確認やデータの再送制御は行わず、その分データを高速に送ることができるので、小さなデータや映像のような多少欠損しても問題なく、信頼性よりも速度を求められる通信に適している。

## IP アドレス

- ホストアドレスにおいて、ホスト部の全てのビットが 0 のアドレスはそのネットワーク自身のアドレスを示し、ホスト部の全てのビットが 1 のアドレスは、そのネットワーク内の全てのホストに届くブロードキャストアドレスという特殊なアドレスを示します。これらのアドレスは実際にコンピュータに割り当てることはできません。
- IP アドレスにはネットワーク部(ホスト部)の長さによって ABC のクラスに分かれている。クラス毎にサブネットマスクが異なる。
- CIDR 表記ではクラス分けをせずにネットワーク部・ホスト部の切り分けができる。

## 経路の確認

- 自分が利用しているコンピュータから通信先のコンピュータまでに仲介する複数のゲートウェイを調べるには traceroute コマンドと racepath コマンドがあります。

# プロセス管理

## プロセスとは

- プログラム(アプリケーション)を管理する単位をプロセスと呼ぶ。

> 「ユーザがシェルからコマンドを実行すると、シェルは子プロセスとして自分の分身を作りますこれを fork と呼びます。）。次に、シェルは子プロセスにコマンドの実行（これを exec と呼びます。）を任せ、子プロセスの終了を待ちます。子プロセスはコマンドの実行を終えると親プロセスに終了を伝え、消滅します。親プロセスは子プロセスの終了を受け取り、シェルプロンプトを表示し、ユーザの次のコマンドに備えます。」

## スケジューリング

- 瞬間瞬間ではプロセスは 1 つしか実行されておらず、それぞれのプロセスの実行順序は Linux のスケジューラによって管理されている。 -プロセスの優先度の設定として、Nice 値というのがある。nice・renice コマンドで設定可能。

## フォアグランドジョブとバックグラウンドジョブ

- プロセスと似た管理単位としてジョブがある。シェルが管理するプログラムの単位。
- シェルからコアンドを実行する場合、ジョブをフォアグラウンドとバックグラウンドに切り替える機能がある。コマンドをバックグラウンドで起動するには、コマンドの後ろに&をつけて実行する。

## プロセス ID

- Linux のプロセスには一意の PID が付与される。自身の PID は$$で取得可能。
- l オプションで、PPID(親プロセス ID)まで表示可能。

## シグナル

- Linux には、プロセスにシグナルというイベントを送信してプロセスを制御する機能がある。
- シグナルには、シグナル番号およびシグナル名が割り当てられている。
- ユーザがプロセスにシグナルを送信する方法は下記 3 つ。
  - シェルに割り当てられたキーの入力(^Z など)
  - kill コマンド
  - プログラムで kill()関数を呼ぶ

## top コマンドと pstree コマンド

- top コマンド・・・実行中のプロセスの状態をダイナミックに表示。

- pstree・・・プロセスの親子関係をツリー表示する。

## プロセス間通信

複数のプロセスがコミュニケーションを取りながら同期したり、動作を変更して処理を達成すること。パイプやシグナルもそのひとつ。

# ファイル管理

## Linux のファイル管理

- Lunux システムは FHS と呼ばれる規格に基づいてディレクトリの構成が定められている。
  - bin・・・一般ユーザ用プログラム
  - sbin・・・システム管理用プログラム
  - etc・・・設定ファイル
  - lib 複数のプログラムで共通に使われるライブラリ
  - var・・・可変的なデータ(ログ・データベース・ウェブサイトなど)

など。厳格な規則というよりは緩やかな決まり事。

## ディスクのパーティション

- fdisk コマンドで現在のパーティション構成の確認等が可能。
- ハードディスクはまるまる 1 つのパーティションとして使うか、2~4 つのパーティションに分割可能(拡張パーティション)。拡張パーティションは 1 台の HDD に 1 つだけ作ることができ、その中井論理パーティションをつくることが可能。

## ファイルシステム

ディレクトリやファイルの情報やデータをディスクのどこに保存してあるか管理するためのシステム。

- Linux の場合は ext3 または 4 が多く利用されている。
- ジャーナリング機能・・・障害時の急停止などに対応。書込み途中のファイルを元に戻すなど。トランザクションみたいなイメージ。
- ラベル・・・パーティションを認識するための名前。

## マウント

- HDD はパーティション分割して、ファイルシステムを作ってからマウントすると読み書きができるようになる。
- HDD や CD-ROM などは、存在しているディレクトリにマウントする必要があり、そのためのディレクトリをマウントポイントと呼ぶ。どのファイルシステムも必ずどこかのディレクトリにマウントして初めて利用可能。
- mount・unmount コマンドで操作。

## スワップ領域の作成

スワップ領域：メモリがキツくなると、一時的に HDD のパーティションにデータを退避させる。そのための領域。

- mkswap コマンドなどを使って、スワップもそれ専用に領域の作成・設定が必要。

## 自動マウント

- インストール時に作られたパーティションは起動時に自動マウントされる。
- HDD 増設時にも自動マウントさせるよう、設定の変更が可能。

## リムーバルメディアの利用

リムーバルメディアを使用する場合、手動でマウントをする必要がある。

## i ノード

ext3 ファイルシステムは、ファイルやディレクトリに対し、i ノード番号というユニークな番号を割り振って管理している。ファイルシステムには i ノード領域という場所が確保されており、ディスク上のファイルの位置やアクセス権限などの情報が保持されている。ファイルシステム全体としての書込み容量に余裕があっても、i ノード領域が埋まるとそれ以上新規のファイルは作成できなくなる。

- df -i コマンドで利用状況確認
- ls -i コアンドで各ファイルの i ノード番号を確認(1 列目)

## ハードリンクとシンボリックリンク

リンク機能は、ファイルをコピーしたり移動したりせずに、別のディレクトリにあるように扱うことができる機能。

- ハードリンク・・・ファイルの実態を直接指示して共有する。別ファイルシステム(別パーティション)には作成できない。
- シンボリックリンク・・・元ファイルが保管されているパスを示す疑似的なファイルを作成。Windows でいうショートカット。
  > ファイルは必ず i ノード情報にリンクしており、ファイルを作るとハードリンクが 1 つできることと同じです。ファイルのハードリンクを作ると i ノードの領域にあるリンク数が 1 つ増え、ハードリンクを削除するとリンク数が 1 つ減ります。ファイルを消してリンク数が 0 になると、ファイルのデータがファイルシステムから完全に削除されます。

## 雑多メモ

- 一般ユーザは基本は sudo 権限(?)を与えられていないので、一旦 root ユーザでログインなりして権限の編集が必要。
  - 般ユーザのターミナル上で 『su -』で root ユーザにアクセスを試みることが可能。PW 分かってればそれで入れる。
